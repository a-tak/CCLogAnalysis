# グループ別のグラフ表示機能追加

**作業日**: 2026-01-25

---

## 概要

グループ別のグラフ表示機能追加

---

## 実装内容

### Phase 1: データベース層の実装とテスト

- ✅ `internal/db/group_stats.go` に `GetGroupTimeSeriesStats` メソッドを実装
- ✅ グループ内の全プロジェクトのセッションを期間ごとに集計
- ✅ `internal/db/group_stats_test.go` にテストケースを追加
  - 日別時系列統計の取得
  - 期間パラメータ（day/week/month）の切り替え
  - セッション0件のケース
  - 無効な期間パラメータのエラーハンドリング
- ✅ すべてのテストがパス

### Phase 2: API層の実装とテスト

- ✅ `internal/api/types.go` に `GetProjectGroupTimeline` メソッドをインターフェースに追加
- ✅ `internal/api/service_db.go` に `GetProjectGroupTimeline` メソッドを実装
- ✅ `internal/api/handlers_groups.go` に `getGroupTimelineHandler` ハンドラーを実装
- ✅ `internal/api/router.go` に `GET /api/groups/{id}/timeline` ルートを追加
- ✅ `internal/api/handlers_groups_test.go` にテストケースを追加
  - グループタイムライン統計の取得
  - 期間パラメータのバリデーション
  - 無効なグループIDでの400エラー
  - 存在しないグループIDでの404エラー
- ✅ すべてのテストがパス

### Phase 3: フロントエンド層の実装

- ✅ `web/src/lib/api/client.ts` に `getProjectGroupTimeline` メソッドを追加
- ✅ `web/src/pages/GroupDetailPage.tsx` にタイムラインチャートを実装
  - 統計カードの後に配置
  - 期間切り替えタブ（日別/週別/月別）
  - Recharts LineChart でグラフ表示
  - 入力トークンと出力トークンの2系列データ
  - レスポンシブデザイン
- ✅ フロントエンドビルド成功

### Phase 4: 統合テストと動作確認

- ✅ サーバー起動・動作確認
- ✅ ブラウザでのグループ別ページ表示
- ✅ グループカードをクリックしてグループ詳細ページへの遷移
- ✅ タイムラインチャートの表示確認
- ✅ 期間切り替え機能（日別→週別→月別）の動作確認
- ✅ グラフデータの正確性確認
  - 日別：1/25, 1/24のデータ表示
  - 週別：週単位での集計
  - 月別：月単位での集計

### Phase 5: ドキュメント更新

- ✅ `docs/API設計.md` に新規エンドポイント追加
  - プロジェクトグループ一覧取得
  - プロジェクトグループ詳細取得
  - プロジェクトグループ統計取得
  - プロジェクトグループタイムライン統計取得（新規）
- ✅ WIPドキュメント更新

---

## 完了チェックリスト

- [x] 実装完了
- [x] テスト作成・パス
- [x] ドキュメント更新
- [ ] コミット実施

---

## 次のステップ

1. 変更内容をコミット
2. GitHubにプッシュ
3. PRを作成して統合

---

## 参考情報

**実装の参考ファイル**:

- `internal/db/project_stats.go` - GetTimeSeriesStats メソッド
- `web/src/pages/ProjectDetailPage.tsx` - タイムラインチャート UI

**関連ドキュメント**:

- docs/API設計.md
- docs/技術スタック.md

**実装統計**:

- 追加コード行数：約250行（バックエンド）、約180行（フロントエンド）
- テストケース：10個（すべてパス）
- 実装期間：約2時間

---

**このドキュメントは /cr-worktree スキルで自動生成されました。**
**作業内容に応じて適宜更新してください。**
