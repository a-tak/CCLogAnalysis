# Claude Code ログ解析アプリケーション 要件定義

## 1. プロジェクト概要

### 目的
Claude Codeに対する各種調整（モデル選択、プロンプト設定など）の効果を、ログ解析を通じて定量的に評価・可視化する。

### 背景・課題
- 現状、調整の効果は「感覚」や「常時監視」でしか把握できない
- データに基づいた客観的な評価ができていない
- 同じ間違いを繰り返すパターンの把握ができていない

---

## 2. 評価対象となるユースケース

### モデル使用の最適化
| 用途 | 現状 | 検討中の変更 |
|------|------|--------------|
| コーディング | Sonnet | Haiku |
| 計画・設計 | Opus | Opus（維持） |
| 難問解決 | - | Opusエージェントに委譲 |

### 検証したい仮説の例
- Haikuでもコーディング品質は維持できるか
    - トークン使用量は削減できる
    - 全体の作業効率は下がらないか
- サブエージェントやスキルの活用でコンテキストが削減できるか
---

## 3. 評価軸（KPI）

### 3.1 トークン使用量
- **入力トークン数**: セッション/タスクごとの消費量
- **出力トークン数**: セッション/タスクごとの消費量
- **モデル別内訳**: Haiku / Sonnet / Opus それぞれの使用量
- **コスト換算**: 使用量を金額に変換

### 3.2 時間効率
- **解決までの所要時間**: タスク開始から完了までの経過時間
- **実作業時間**: AIが実際に処理していた時間
- **待機時間**: ユーザー入力待ちなどのアイドル時間

### 3.3 試行錯誤パターン分析
- **リトライ回数**: 同一タスクでの再試行回数
- **エラーパターン**: 繰り返し発生するエラーの分類
- **失敗→成功パターン**: どのような手順で解決に至ったか
- **一発成功率**: 最初の試行で成功した割合

---

## 4. 機能要件

### Phase 1: MVP（最小限の機能）

#### 4.1 ログ取り込み機能
- [ ] Claude Codeのログファイル読み込み
- [ ] ログフォーマットのパース
- [ ] セッション/タスク単位での分割

#### 4.2 やり取り確認機能
- [ ] セッション一覧表示
- [ ] 各セッションのやり取り（会話履歴）の閲覧
- [ ] ツール呼び出し履歴の表示

#### 4.3 基本解析機能
- [ ] トークン使用量の集計
- [ ] モデル別使用量の内訳
- [ ] 時間計測・集計

#### 4.4 基本レポート機能
- [ ] セッションごとのサマリー表示
- [ ] トークン使用量レポート

---

### Phase 2: 拡張機能

#### 4.5 高度な解析機能
- [ ] エラーパターンの検出・分類
- [ ] 試行錯誤シーケンスの抽出
- [ ] 一発成功率の算出

#### 4.6 タスク要約機能（将来拡張）
- [ ] タスクごとの内容要約（AI活用）
- [ ] タスク分類・タグ付け
- [ ] タスク種別ごとの傾向分析

#### 4.7 高度なレポート機能
- [ ] 期間別推移グラフ
- [ ] モデル別比較レポート
- [ ] 問題パターン一覧

#### 4.8 データ管理
- [ ] 解析結果の保存
- [ ] 過去データとの比較
- [ ] エクスポート機能（CSV/JSON）

---

## 5. ログデータの構造

### 5.1 ログの保存場所
- **場所**: `~/.claude/projects/` 配下
- **構造**: プロジェクトごとにフォルダが分かれている

### 5.2 Gitワークツリー対応（重要）
- 1つのリポジトリでも、Gitワークツリー機能により**複数のプロジェクトフォルダ**に分かれる
- 並行開発のため、関連する複数のワークツリーを**まとめて分析**する必要がある
- 単一フォルダ参照ではなく、**プロジェクトグループ**として管理

### 5.3 対応すべき構造
```
~/.claude/projects/
├── my-repo/              # メインのワークツリー
├── my-repo-feature-a/    # ワークツリー1
├── my-repo-feature-b/    # ワークツリー2
└── my-repo-bugfix/       # ワークツリー3
```

→ これらを「my-repoプロジェクト」としてグループ化して分析

---

## 6. 非機能要件

### 6.1 対応環境
- [ ] 対応OS: （要決定）
- [ ] 実行形態: CLI / GUI / Web（要決定）

### 6.2 データ
- [ ] ログファイルの保存場所対応
- [ ] 大容量ログへの対応
- [ ] 複数プロジェクトフォルダの一括読み込み

---

## 7. 未確定事項・要検討

### ログフォーマット
- Claude Codeのログ形式の詳細調査が必要
- どのような情報がログに含まれているか確認
- トークン数、モデル情報、タイムスタンプ等の有無

### UIの形態
- CLI（コマンドライン）
- デスクトップアプリ（GUI）
- Webアプリ

### プロジェクトグループの定義方法
- ワークツリー名のパターンマッチで自動グループ化？
- 設定ファイルで手動定義？
- 両方対応？

---

## 8. 次のステップ

1. **Claude Codeのログフォーマット調査** ← まずここから
   - 実際のログファイルを確認
   - 含まれる情報の洗い出し
2. アプリケーション形態の決定
3. 技術スタック選定
4. 設計・実装開始
