# 技術スタック選定

## 選定日
2026-01-24

---

## 1. アプリケーション構成

### 全体アーキテクチャ
```
┌─────────────────────────────────────────────────┐
│                   配布形態                       │
│              1バイナリ（Go embed）               │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌──────────────┐      ┌──────────────────┐    │
│  │   Frontend   │      │     Backend      │    │
│  │    React     │◄────►│       Go         │    │
│  │  (embed済)   │ REST │                  │    │
│  └──────────────┘  API └──────────────────┘    │
│                              │                  │
│                              ▼                  │
│                     ┌──────────────┐           │
│                     │   SQLite     │           │
│                     │  (1ファイル)  │           │
│                     └──────────────┘           │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 配布方式
- **1バイナリ配布**: Go 1.16+ の `embed` パッケージでReactビルド成果物を埋め込み
- **対応OS**: Windows + Mac
- **実行方法**: バイナリ実行 → ブラウザでアクセス（`http://localhost:xxxx`）

---

## 2. バックエンド

### 言語・フレームワーク
| 項目 | 選定 | 理由 |
|------|------|------|
| 言語 | **Go** | クロスコンパイル容易、1バイナリ配布、テキスト処理得意 |
| HTTPサーバー | 標準ライブラリ or Echo/Gin | シンプルなREST API |
| DB | **SQLite** | ファイル1つで完結、配布が楽 |

### 主な処理
- JSONLログファイルのパース
- トークン使用量・時間の集計
- REST APIの提供
- 将来: Claude API呼び出し（要約機能）

---

## 3. フロントエンド

### フレームワーク・ライブラリ
| 項目 | 選定 | 理由 |
|------|------|------|
| フレームワーク | **React** | リッチなUI、エコシステム充実 |
| スタイリング | **Tailwind CSS** | ユーティリティファースト、軽量 |
| UIコンポーネント | **shadcn/ui** | カスタマイズしやすい、モダン |
| グラフ | **Recharts** | React向け、シンプルなAPI |
| ビルドツール | Vite | 高速、設定シンプル |

### 開発時の環境
- Node.js + npm/pnpm が必要（ビルド用）
- 配布時は不要（Goバイナリに埋め込み済）

---

## 4. 機能設計

### ログ解析のトリガー
- **手動実行**: UIから「解析実行」ボタンでトリガー
- 理由: バッチ実行の待ち時間によるストレスを回避、明示的な操作で結果を確認

### プロジェクトグループ化
- **両方対応**:
  - パターンマッチによる自動検出（フォルダ名プレフィックス）
  - 設定ファイルでの手動定義・調整

### 将来の要約機能
- Claude APIを直接呼び出し
- セッション完了後に要約を生成

---

## 5. Phase 1 (MVP) スコープ

### 含める機能
- [ ] ログファイル読み込み・パース
- [ ] セッション一覧表示
- [ ] **会話履歴の閲覧**（やり取りを見れることが重要）
- [ ] ツール呼び出し履歴の表示
- [ ] トークン使用量の集計・表示
- [ ] モデル別使用量の内訳
- [ ] 基本的なレポート表示

### Phase 2以降
- エラーパターン検出
- 要約機能（Claude API連携）
- 期間別推移グラフ
- エクスポート機能

---

## 6. ディレクトリ構成案

```
CCLogAnalysis/
├── cmd/
│   └── server/
│       └── main.go          # エントリーポイント
├── internal/
│   ├── api/                  # REST APIハンドラー
│   ├── parser/               # JSONLパーサー
│   ├── analyzer/             # 集計ロジック
│   ├── db/                   # SQLite操作
│   └── config/               # 設定管理
├── web/                      # Reactプロジェクト
│   ├── src/
│   ├── package.json
│   └── vite.config.ts
├── docs/                     # ドキュメント
├── go.mod
├── go.sum
└── Makefile                  # ビルドスクリプト
```

---

## 7. 開発環境要件

### 必須
- Go 1.21+
- Node.js 20+ (フロントエンドビルド用)
- npm または pnpm

### 推奨
- Make (ビルドスクリプト実行用)
- Air (Go ホットリロード)

---

## 8. 次のステップ

1. プロジェクト初期化（Go mod init, React プロジェクト作成）
2. 基本的なプロジェクト構造の作成
3. JSONLパーサーの実装
4. REST API設計
5. フロントエンド画面設計
