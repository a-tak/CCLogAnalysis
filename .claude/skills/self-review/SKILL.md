---
model: claude-sonnet-4-5
name: self-review
description: コード変更の自動レビュー
allowed-tools:
  - Bash
  - Read
  - Grep
---

# self-review

## Context

mainブランチからの差分をレビューし、問題を指摘します。
重大度別（P0: Blocker、P1: Critical、P2: Major、P3: Minor）に分類し、P0/P1が検出された場合は修正を求めます。

## Your task

1. `git diff origin/main...HEAD` でmainブランチからの変更を取得
2. 変更内容をレビュー
3. 重大度別に指摘を分類
4. レビュー結果を表示

## レビュー基準

### P0（Blocker）- 修正必須
- セキュリティ脆弱性（SQL injection, XSS, CSRF, etc.）
- データ損失の可能性
- システムクラッシュを引き起こす致命的バグ
- 認証・認可の重大な欠陥

### P1（Critical）- 修正必須
- 機能を阻害するバグ
- パフォーマンスの重大な劣化
- 重要なベストプラクティス違反
- エラーハンドリングの欠如
- メモリリークの可能性

### P2（Major）- 改善推奨
- コード品質問題（複雑度が高い、重複コード）
- テストカバレッジ不足
- ドキュメント不足
- 軽微なパフォーマンス問題
- ログ出力の不足

### P3（Minor）- 軽微な改善提案
- コーディングスタイルの不統一
- 命名の改善提案
- コメントの改善
- リファクタリング提案

## 処理フロー

1. **差分取得**
   ```bash
   git fetch origin main
   git diff origin/main...HEAD
   ```

2. **レビュー実施**
   - セキュリティ観点
   - コード品質観点
   - ベストプラクティス観点
   - パフォーマンス観点
   - テスト・ドキュメント観点

3. **結果集計**
   - P0、P1、P2、P3ごとに指摘を整理
   - ファイル名と行番号を明記
   - 具体的な修正提案を含める

## 出力フォーマット

### 指摘がある場合

```
📋 セルフレビュー結果

【P0: Blocker】<件数>件
- <ファイル名>:<行番号> - <指摘内容>
  修正案: <具体的な修正方法>

【P1: Critical】<件数>件
- <ファイル名>:<行番号> - <指摘内容>
  修正案: <具体的な修正方法>

【P2: Major】<件数>件
- <ファイル名>:<行番号> - <指摘内容>
  修正案: <具体的な修正方法>

【P3: Minor】<件数>件
- <ファイル名>:<行番号> - <指摘内容>
  修正案: <具体的な修正方法>

---
⚠️ P0/P1が検出されました。修正が必要です。
✅ P0/P1はありません。PR作成準備が可能です。
```

### 指摘がない場合

```
✅ セルフレビュー完了

変更内容を確認しましたが、特に指摘すべき問題は見つかりませんでした。
PR作成準備が可能です。
```

## 重要な注意事項

1. **厳密なレビュー**: セキュリティとバグには特に注意
2. **具体的な指摘**: 抽象的な指摘ではなく、ファイル名・行番号・修正案を明示
3. **プロジェクト固有のルール**: CLAUDE.md、.claude/rules/ の内容を考慮
4. **バランス**: 過度に細かい指摘は避け、重要な問題に焦点を当てる
5. **P0/P1の基準**: 本当に修正必須の項目のみをP0/P1に分類

## プロジェクト固有の確認項目

### 個人情報の取り扱い（CLAUDE.md参照）
- ユーザー名、プロジェクト固有の名前が含まれていないか
- 実際のパスが含まれていないか
- 個人を特定できる情報が含まれていないか

### Go バックエンド
- エラーハンドリングが適切か
- コンテキストの伝播が正しいか
- リソースのクリーンアップ（defer）が適切か

### React フロントエンド
- TypeScript型定義が正しいか
- 適切なエラーハンドリングとローディング状態
- アクセシビリティの考慮

### テスト
- 新機能にテストが含まれているか（TDD原則）
- テストが意味のある検証をしているか
